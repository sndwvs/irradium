# Description: A media player, streamer, and encoder
# URL: http://www.videolan.org/vlc/
# Maintainer: mara, mara at fail dot pp dot ua
# Depends on: alsa-lib ffmpeg liba52 libgcrypt libmad lua52 libidn libvpx libwebp pulseaudio
# Optional: wayland libdvdnav libdvdread faad2 flac libcddb libva speex dav1d gnutls libsdl2 libtheora libva libvdpau libvorbis x264

name=vlc
version=3.0.20
release=1
source=(https://download.videolan.org/$name/$version/$name-$version.tar.xz)

build() {
  cd $name-$version

  prt-get isinst wayland && PKGMK_VLC+=" --enable-wayland" || PKGMK_VLC+=" --disable-wayland"
  prt-get isinst libdvdnav && PKGMK_VLC+=" --enable-dvdnav"
  prt-get isinst libdvdread && PKGMK_VLC+=" --enable-dvdread"
  prt-get isinst faad2 && PKGMK_VLC+=" --enable-faad"
  prt-get isinst flac && PKGMK_VLC+=" --enable-flac"
  prt-get isinst libcddb && PKGMK_VLC+=" --enable-libcddb"
  prt-get isinst libva && PKGMK_VLC+=" --enable-libva"
  prt-get isinst speex && PKGMK_VLC+=" --enable-speex"
  prt-get isinst taglib && PKGMK_VLC+=" --enable-taglib"
  prt-get isinst dav1d && PKGMK_VLC+=' --enable-dav1d'
  prt-get isinst gnutls && PKGMK_VLC+=' --enable-gnutls'
  prt-get isinst libtheora && PKGMK_VLC+=' --enable-theora'
  prt-get isinst libvdpau && PKGMK_VLC+=' --enable-vdpau'
  prt-get isinst libvorbis && PKGMK_VLC+=' --enable-vorbis'
  prt-get isinst x264 && PKGMK_VLC+=' --enable-x264'

  NOCONFIGURE=1 ./bootstrap

  BUILDCC=gcc \
  CFLAGS="$CFLAGS -fcommon -flto=auto" \
  CXXFLAGS="$CXXFLAGS -flto=auto" \
  LUA=lua5.2 \
  LUAC=luac5.2 \
  ./configure $PKGMK_VLC \
    --prefix=/usr \
    --libdir=/usr/lib \
    --disable-nls \
    --disable-rpath \
    --disable-static \
    --enable-a52 \
    --enable-merge-ffmpeg \
    --enable-run-as-root \
    --enable-skins2

  make
  make DESTDIR=$PKG install
}
