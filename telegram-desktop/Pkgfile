# Description: Official Telegram Desktop client
# URL: https://desktop.telegram.org
# Maintainer: mara, mara at fail dot pp dot ua
# Depends on: minizip openal range-v3 tg_owt qt6-imageformats qt6-svg qt6-wayland qt6-5compat rnnoise protobuf fmt graphviz mm-common boost libsigc++

name=telegram-desktop
version=4.11.8
release=2
source=(https://github.com/telegramdesktop/tdesktop/releases/download/v$version/tdesktop-$version-full.tar.gz)

build() {
  cd tdesktop-$version-full

  LDFLAGS="$LDFLAGS -Wl,-z,stack-size=1024768" \
  cmake -B build -G Ninja . \
    -DCMAKE_INSTALL_PREFIX=/usr \
    -DCMAKE_BUILD_TYPE=MinSizeRel \
    -DTDESKTOP_API_ID=28851236 \
    -DTDESKTOP_API_HASH=830f83e5afbad782af2704a120e4dcdf \
    -DDESKTOP_APP_DISABLE_CRASH_REPORTS=ON \
    -DDESKTOP_APP_DISABLE_JEMALLOC=ON \
    -DDESKTOP_APP_USE_PACKAGED=ON

  cmake --build build
  DESTDIR=$PKG cmake --install build
}
