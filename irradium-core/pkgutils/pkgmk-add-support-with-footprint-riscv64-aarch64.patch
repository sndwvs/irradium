--- a/pkgmk.in	2023-02-03 18:32:32.000000000 +0200
+++ b/pkgmk.in	2024-07-12 21:26:46.872713446 +0300
@@ -324,7 +324,13 @@ check_signature() {
 		srcind=$(( srcind+1 ))
 		done
 
-		for FILE in "$PKGMK_PKGFILE" "$PKGMK_FOOTPRINT" "${source[@]}"; do
+		if [ ! -z ${MULTI_ARCH} -a -f ${PKGMK_FOOTPRINT}.${MULTI_ARCH} -o -f ${PKGMK_SIGNATURE}.${MULTI_ARCH} ]; then
+			_PKGMK_FOOTPRINT=${PKGMK_FOOTPRINT}.${MULTI_ARCH}
+		else
+			_PKGMK_FOOTPRINT=${PKGMK_FOOTPRINT}
+		fi
+
+		for FILE in "$PKGMK_PKGFILE" "${_PKGMK_FOOTPRINT}" "${source[@]}"; do
 			ln -s $(get_filename -a $FILE) .
 		done
 
@@ -397,7 +403,13 @@ make_signature() {
 		srcind=$(( srcind+1 ))
 	done
 
-	for FILE in "$PKGMK_PKGFILE" "$PKGMK_FOOTPRINT" "${source[@]}"; do
+	if [ ! -z ${MULTI_ARCH} -a -f ${PKGMK_FOOTPRINT}.${MULTI_ARCH} -o -f ${PKGMK_SIGNATURE}.${MULTI_ARCH} ]; then
+		_PKGMK_FOOTPRINT=${PKGMK_FOOTPRINT}.${MULTI_ARCH}
+	else
+		_PKGMK_FOOTPRINT=${PKGMK_FOOTPRINT}
+	fi
+
+	for FILE in "$PKGMK_PKGFILE" "${_PKGMK_FOOTPRINT}" "${source[@]}"; do
 		LOCAL_FILENAMES="$LOCAL_FILENAMES `get_filename $FILE`"
 	done
 
@@ -419,7 +431,17 @@ make_signature() {
 		error "Creating signature failed"
 		exit $E_SIGNATURE
 	else
-		mv ${PKGMK_SIGNATURE}.tmp ${PKGMK_SIGNATURE}
+		if [ ! -z ${MULTI_ARCH} -a -f ${PKGMK_FOOTPRINT}.${MULTI_ARCH} -o -f ${PKGMK_SIGNATURE}.${MULTI_ARCH} ]; then
+			if [ -f ${PKGMK_SIGNATURE} ]; then
+				rm ${PKGMK_SIGNATURE}
+			fi
+			mv ${PKGMK_SIGNATURE}.tmp ${PKGMK_SIGNATURE}.${MULTI_ARCH}
+		else
+			if [ -f ${PKGMK_SIGNATURE}.${MULTI_ARCH} ]; then
+				rm ${PKGMK_SIGNATURE}.${MULTI_ARCH}
+			fi
+			mv ${PKGMK_SIGNATURE}.tmp ${PKGMK_SIGNATURE}
+		fi
 	fi
 }
 
@@ -442,7 +464,17 @@ refresh_signature() {
 		error "Refreshing signature failed"
 		exit $E_SIGNATURE
 	else
-		mv ${PKGMK_SIGNATURE}.tmp ${PKGMK_SIGNATURE}
+		if [ ! -z ${MULTI_ARCH} -a -f ${PKGMK_FOOTPRINT}.${MULTI_ARCH} -o -f ${PKGMK_SIGNATURE}.${MULTI_ARCH} ]; then
+			if [ -f ${PKGMK_SIGNATURE} ]; then
+				rm ${PKGMK_SIGNATURE}
+			fi
+			mv ${PKGMK_SIGNATURE}.tmp ${PKGMK_SIGNATURE}.${MULTI_ARCH}
+		else
+			if [ -f ${PKGMK_SIGNATURE}.${MULTI_ARCH} ]; then
+				rm ${PKGMK_SIGNATURE}.${MULTI_ARCH}
+			fi
+			mv ${PKGMK_SIGNATURE}.tmp ${PKGMK_SIGNATURE}
+		fi
 	fi
 }
 
@@ -502,6 +534,12 @@ check_footprint() {
 
 	cd $PKGMK_ROOT
 
+	if [ ! -z ${MULTI_ARCH} -a -f ${PKGMK_FOOTPRINT}.${MULTI_ARCH} -o -f ${PKGMK_SIGNATURE}.${MULTI_ARCH} ]; then
+		PKGMK_FOOTPRINT=${PKGMK_FOOTPRINT}.${MULTI_ARCH}
+	else
+		PKGMK_FOOTPRINT=${PKGMK_FOOTPRINT}
+	fi
+
 	if [ -f $TARGET ]; then
 		make_footprint > $FILE.footprint
 		if [ -f $PKGMK_FOOTPRINT ]; then
@@ -688,6 +726,18 @@ update_footprint() {
 		exit 1
 	fi
 
+	if [ ! -z ${MULTI_ARCH} -a -f ${PKGMK_FOOTPRINT}.${MULTI_ARCH} -o -f ${PKGMK_SIGNATURE}.${MULTI_ARCH} ]; then
+		if [ -f $PKGMK_FOOTPRINT ]; then
+			rm $PKGMK_FOOTPRINT
+		fi
+		PKGMK_FOOTPRINT=${PKGMK_FOOTPRINT}.${MULTI_ARCH}
+	else
+		if [ -f $PKGMK_FOOTPRINT.${MULTI_ARCH} ]; then
+			rm $PKGMK_FOOTPRINT.${MULTI_ARCH}
+		fi
+		PKGMK_FOOTPRINT=${PKGMK_FOOTPRINT}
+	fi
+
 	check_file "$PKGMK_FOOTPRINT"
 	make_footprint > $PKGMK_FOOTPRINT
 	touch $TARGET
@@ -961,6 +1011,8 @@ trap "interrupted" SIGHUP SIGINT SIGQUIT
 
 export LC_ALL=C.UTF-8
 
+MULTI_ARCH=${MULTI_ARCH:-$( [ $( uname -m ) == "aarch64" -o $( uname -m ) == "riscv64" ] && echo "$( uname -m)" || echo "" )}
+
 readonly PKGMK_VERSION="#VERSION#"
 readonly PKGMK_COMMAND="$0"
 readonly PKGMK_ROOT="$PWD"
